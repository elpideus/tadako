#!/usr/bin/env node
"use strict";var ie=Object.create;var j=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty;var ce=(O,t)=>()=>(t||O((t={exports:{}}).exports,t),t.exports);var Oe=(O,t,I,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let T of le(t))!Ie.call(O,T)&&T!==I&&j(O,T,{get:()=>t[T],enumerable:!(e=re(t,T))||e.enumerable});return O};var C=(O,t,I)=>(I=O!=null?ie(Ae(O)):{},Oe(t||!O||!O.__esModule?j(I,"default",{value:O,enumerable:!0}):I,O));var q=ce((ln,Ne)=>{Ne.exports={name:"tadako",version:"2.4.0",description:"An unofficial AnimeWorld API",author:"Stefan Cucoranu <elpideus@gmail.com>",license:"GPLv3",repository:{type:"git",url:"https://github.com/elpideus/tadako.git"},main:"index.js",type:"commonjs",keywords:["anime","data","information","api","scraping"],scripts:{build:"npx esbuild cli.ts --bundle --outfile=cli.js --platform=node --format=cjs --minify --target=node22 --external:cheerio --external:esbuild --external:puppeteer",reinstall:"npm uninstall -g tadako && npm install -g .",build_and_reinstall:"npm run build && npm run reinstall"},peerDependencies:{typescript:"^5.7.2"},dependencies:{cheerio:"^1.0.0",esbuild:"^0.24.2",puppeteer:"^24.1.1"},files:["index.ts","cli.ts","cli.js","src","src/Tadako.ts","LICENSE","tsconfig.json","README.md"],devDependencies:{"@types/node":"^22.10.4",typescript:"^5.7.3"},bin:{tadako:"cli.js"}}});var X=C(require("puppeteer")),Q=C(require("cheerio"));var L={ANIME:0,MOVIE:4,OVA:1,ONA:2,SPECIAL:3,MUSIC:5};var b=(E=>(E.JAPANESE="jp",E.ITALIAN="it",E.CHINESE="ch",E.KOREAN="kr",E.ENGLISH="en",E))(b||{});var S=(s=>(s[s.MARTIAL_ARTS=3]="MARTIAL_ARTS",s[s.AVANTGARDE=5]="AVANTGARDE",s[s.ADVENTURE=2]="ADVENTURE",s[s.ACTION=1]="ACTION",s[s.CHILDREN=47]="CHILDREN",s[s.COMEDY=4]="COMEDY",s[s.DEMONS=6]="DEMONS",s[s.DRAMATIC=7]="DRAMATIC",s[s.ECCHI=8]="ECCHI",s[s.FANTASY=9]="FANTASY",s[s.GAME=10]="GAME",s[s.HAREM=11]="HAREM",s[s.HENTAI=43]="HENTAI",s[s.HORROR=13]="HORROR",s[s.JOSEI=14]="JOSEI",s[s.MAGIC=16]="MAGIC",s[s.MECHA=18]="MECHA",s[s.MILITARY=19]="MILITARY",s[s.MYSTERY=21]="MYSTERY",s[s.MUSIC=20]="MUSIC",s[s.PARODY=22]="PARODY",s[s.POLICE=23]="POLICE",s[s.PSYCHOLOGICAL=24]="PSYCHOLOGICAL",s[s.ROMANTIC=46]="ROMANTIC",s[s.SAMURAI=26]="SAMURAI",s[s.SCIFI=28]="SCIFI",s[s.SCHOOL=27]="SCHOOL",s[s.SEINEN=29]="SEINEN",s[s.SENTIMENTAL=25]="SENTIMENTAL",s[s.SHOUJO=30]="SHOUJO",s[s.SHOUJO_AI=31]="SHOUJO_AI",s[s.SHOUNEN=32]="SHOUNEN",s[s.SHOUNEN_AI=33]="SHOUNEN_AI",s[s.SLICE_OF_LIFE=34]="SLICE_OF_LIFE",s[s.SPACE=35]="SPACE",s[s.SUPERNATURAL=37]="SUPERNATURAL",s[s.SPORT=36]="SPORT",s[s.HISTORY=12]="HISTORY",s[s.SUPERPOWERS=38]="SUPERPOWERS",s[s.THRILLER=39]="THRILLER",s[s.VAMPIRES=40]="VAMPIRES",s[s.VEHICLES=48]="VEHICLES",s[s.YAOI=41]="YAOI",s[s.YURI=42]="YURI",s))(S||{}),P={"ARTI MARZIALI":3,AVANGUARDIA:5,AVVENTURA:2,AZIONE:1,BAMBINI:47,COMMEDIA:4,DEMONI:6,DRAMMATICO:7,ECCHI:8,FANTASY:9,GIOCO:10,HAREM:11,HENTAI:43,HORROR:13,JOSEI:14,MAGIA:16,MECHA:18,MILITARI:19,MISTERO:21,MUSICALE:20,PARODIA:22,POLIZIA:23,PSICOLOGICO:24,ROMANTICO:46,SAMURAI:26,"SCI-FI":28,SCOLASTICO:27,SEINEN:29,SENTIMENTALE:25,SHOUJO:30,"SHOUJO AI":31,SHOUNEN:32,"SHOUNEN AI":33,"SLICE OF LIFE":34,SPAZIO:35,SOPRANNATURALE:37,SPORT:36,STORICO:12,SUPERPOTERI:38,THRILLER:39,VAMPIRI:40,VEICOLI:48,YAOI:41,YURI:42};var B={DEFAULT:0,NEW_ADDITIONS:1,NEW:1,A_TO_Z:2,ATOZ:2,ALPHABETICAL:2,Z_TO_A:3,ZTOA:3,OLDEST:4,LATEST:5,VIEWS:6,"MOST VIEWED":6,MOST_VIEWED:6};var H={ONGOING:0,AIRING:0,FINISHED:1,UNRELEASED:2,DROPPED:3},x={"IN CORSO":0,IN_CORSO:0,INCORSO:0,FINITO:1,"NON RILASCIATO":2,NON_RILASCIATO:2,NONRILASCIATO:2,DROPPATO:3};var U=class{static parseItalianDate=t=>{let I={Gennaio:1,Febbraio:2,Marzo:3,Aprile:4,Maggio:5,Giugno:6,Luglio:7,Agosto:8,Settembre:9,Ottobre:10,Novembre:11,Dicembre:12};if(!t)return null;let e=t.trim().split(" ");if(e.length!==3)return null;let[T,E,m]=e,_=parseInt(T,10),g=I[E],M=parseInt(m,10);return!_||!g||!M?null:new Date(M,g-1,_)};static secondsToHumanTime=t=>{let I=Math.floor(t/86400);t%=24*3600;let e=Math.floor(t/3600);t%=3600;let T=Math.floor(t/60);t%=60;let E=[];return I>0&&E.push(`${I} day${I>1?"s":""}`),e>0&&E.push(`${e} hour${e>1?"s":""}`),T>0&&E.push(`${T} minute${T>1?"s":""}`),(t>0||E.length===0)&&E.push(`${t} second${t>1?"s":""}`),E.join(" ")}};var $=C(require("node:os"));var K=C(require("node:os")),k=C(require("node:path")),v=C(require("https")),Y=C(require("fs"));var h=class{url;fileName;outputDir;constructor(t,I=null,e=null){this.url=t;let T=t.split("/");this.fileName=I??T[T.length-1],this.outputDir=e??k.default.join(K.homedir(),"Downloads")}downloadFile=async(t=Math.ceil(K.cpus().length/2),I=!0)=>{let e=k.default.join(this.outputDir,this.fileName),E=await new Promise((a,A)=>{v.default.get(this.url,{method:"HEAD"},r=>{if(r.statusCode!==200&&r.statusCode!==206){A(new Error(`Failed to fetch file headers: ${r.statusCode}`));return}a(r.headers)}).on("error",A)}),m=parseInt(E["content-length"]||"0",10);if(!m)throw new Error("Unable to determine file size.");try{if((await Y.default.promises.stat(e)).size===m){console.log(`File already exists: ${this.fileName} (${(m/1024/1024).toFixed(2)} MB). Skipping download...`);return}}catch{}let _=Math.ceil(m/t),g=0,M=0,i=Date.now(),o=Date.now();console.log(`Downloading ${this.fileName} (${t} ${t>1?"threads":"thread"}) ...`);let l=0,n=setInterval(()=>{let a=g/m*100,A=(Date.now()-o)/1e3;Date.now()-i>=5e3&&(M=g/1024/1024/A,i=Date.now());let r=m-g,p=Math.floor(M>0?r/(M*1024*1024):0);process.stdout.clearLine(0),process.stdout.cursorTo(0);let R=m<2*1024*1024*1024?Math.floor(a):a.toFixed(2);process.stdout.write(`Downloaded: ${R}% (${(g/1024/1024).toFixed(2)} MB / ${(m/1024/1024).toFixed(2)} MB) - Speed: ${M.toFixed(2)} MB/s ETA: ${U.secondsToHumanTime(p)}`),l+=1},1e3),c=(a,A,r)=>new Promise((p,R)=>{let G={headers:{Range:`bytes=${a}-${A}`}};v.default.get(this.url,G,w=>{if(w.statusCode!==206){R(new Error(`Failed to download chunk ${r}: ${w.statusCode}`));return}let J=[];w.on("data",Z=>{J.push(Z),g+=Z.length}),w.on("end",()=>{p(Buffer.concat(J))}),w.on("error",R)})}),N=[];for(let a=0;a<t;a++){let A=a*_,r=Math.min(m-1,(a+1)*_-1);N.push(c(A,r,a))}try{let a=await Promise.all(N);await Y.default.promises.writeFile(e,Buffer.concat(a)),clearInterval(n);let A=`Finished downloading ${this.fileName} (${(m/1024/1024).toFixed(2)} MB) in ${U.secondsToHumanTime(l)}.
`;I?(console.clear(),console.log(A)):(process.stdout.clearLine(0),process.stdout.cursorTo(0),process.stdout.write(A))}catch(a){throw clearInterval(n),a}}};var z=C(require("node:path")),y=class{url;anime;constructor(t,I=null){this.url=t,this.anime=I}getDownloadURL=async()=>(await D.parse(this.url))("#download .widget.downloads .widget-body #alternativeDownloadLink").attr("href");download=async(t=null,I=null,e=Math.ceil($.cpus().length/2))=>{if(t||(t=z.join($.homedir(),"Downloads")),!I){let T=(await this.getDownloadURL())?.split("/");T&&T.length>1&&(I=T[T.length-1],await new h(await this.getDownloadURL()??"",I,t).downloadFile(e));return}await new h(this.url,I,t).downloadFile(e)}};var u=class{url;title="";alternativeTitle=null;poster=null;AniListURL=null;MyAnimeListURL=null;trailer=null;category=null;releaseDate=null;season=null;studio=null;genres=[];rating=null;duration=null;episodes=[];status=null;views=null;keywords=null;shortDescription=null;constructor(t,I={}){this.url=t,Object.assign(this,I)}data=async()=>(await this.init(),this);init=async()=>{let t=await D.parse(this.url);return this.title=t("#anime-title").text(),this.alternativeTitle=t("#anime-title").attr("data-jtitle")??this.alternativeTitle,this.poster=t("#main .content .widget.info .widget-body .row .info .thumb .img").attr("src")??this.poster,this.AniListURL=t("#anilist-button")?.attr("href")??this.AniListURL,this.MyAnimeListURL=t("#mal-button")?.attr("href")??this.MyAnimeListURL,this.trailer=t("#controls .trailer")?.attr("data-url")?`https://www.youtube.com/watch?v=${t("#controls .trailer")?.attr("data-url")?.split("/").pop()}`:this.trailer,this.category=L[t('dt:contains("Categoria:")').next().text().trim().toUpperCase()],this.releaseDate=U.parseItalianDate(t('dt:contains("Data di Uscita:")').next().text().trim()),this.season=t('dt:contains("Stagione:")').next().find("a").text().trim(),this.studio=t('dt:contains("Studio:")').next().find("a").text().trim(),t('dt:contains("Genere:")').next().find("a").each((I,e)=>{this.genres.push(P[t(e).text().trim().toUpperCase()])}),this.rating=parseFloat(t('dt:contains("Voto:")').next().find(".rating span").text().trim()),this.duration=t('dt:contains("Durata:")').next().text().trim(),t("#animeId .widget-body .server.active .episodes.range").each((I,e)=>{t(e).find("li.episode").each((T,E)=>{this.episodes.push(new y(`https://${D.domain}${t(E).find("a").attr("href")}`,this))})}),this.status=x[t('dt:contains("Stato:")').next().find("a").text().trim().toUpperCase()],this.views=parseInt(t('dt:contains("Visualizzazioni:")').next().text().trim()),this.keywords=t("#tagsReload").text(),this}};var D=class O{smthn="lol";static domain="www.animeworld.so";static routes={list:"az-list",search:"filter"};static async parse(t){let I=await X.default.launch({headless:"shell",args:["--no-sandbox","--disable-setuid-sandbox"]}),e=await I.newPage();await e.setRequestInterception(!0),e.on("request",async E=>{let m=E.resourceType();["image","stylesheet","font","media","script"].includes(m)?await E.abort():await E.continue()}),await e.goto(t,{waitUntil:"domcontentloaded"});let T=await e.content();return await I.close(),Q.load(T)}static async list(t=1,I=null){let e=await O.parse(`https://${this.domain}/${this.routes.list}`),T=parseInt(e("#main .content .widget.az-list .widget-body div .paging-wrapper #paging-form .total").text())||1,E=[];return e("#main .content .widget.az-list .widget-body .items .item").each((m,_)=>{let g=e(_);E.push(new u(`https://${O.domain}${g.find(".info .name").attr("href")}`,{title:g.find(".info .name").text(),shortDescription:g.find(".info p").text(),poster:g.find("a img").attr("src")||null,releaseDate:U.parseItalianDate(g.find(".info .name").attr("data-tippy-content")||"")||new Date}))}),{page:t>T?1:t,maxPages:T,results:E}}static async search(t="",I={}){let e=Object.entries(I).filter(([g,M])=>M!=null).map(([g,M])=>`${g}=${encodeURIComponent(M)}`).join("&"),T=await O.parse(`https://${this.domain}/${this.routes.search}?keyword=${t}&${e}`),E=[];T("#main .content .widget .widget-body .film-list .item").each((g,M)=>{let i=T(M),o=0;i.find("a.poster .status .movie")&&(o=4),i.find("a.poster .status .ova")&&(o=1),i.find("a.poster .status .ona")&&(o=2),i.find("a.poster .status .special")&&(o=3),i.find("a.poster .status .music")&&(o=5),E.push(new u(`https://${O.domain}${i.find(".inner a.name").attr("href")}`,{title:i.find(".inner a.name").text(),poster:i.find(".inner a.poster img").attr("src"),alternativeTitle:i.find(".inner a.name").attr("data-jtitle"),category:o}))});let m=T("#main .content .widget .widget-body .paging-wrapper #paging-form #page-input").attr("placeholder")||"1",_=T("#main .content .widget .widget-body .paging-wrapper #paging-form .total").text()||"1";return{page:I.page||parseInt(m),maxPages:parseInt(_),results:E,filters:I}}};var d=require("node:child_process"),V=C(require("readline")),f=C(require("node:path"));var F=C(require("node:os"));var oe=C(require("fs"));var W={h:"help",v:"version",e:"episode",l:"language",c:"category",t:"threads",o:"out-dir",f:"filename"},ee=(O,t=W)=>{let I={},e=null;for(let T=0;T<O.length;T++){let E=O[T];if(E.startsWith("--"))e=E.slice(2),I[e]=!0;else if(E.startsWith("-")){if(O.length<1)continue;let m=E.slice(1),_=t[m];_?(e=_,I[_]=!0):console.warn(`Unknown short flag: -${m}`)}else e&&(I[e]=E,e=null)}return I},ne=async()=>{try{let O=oe.default.readFileSync(f.join(__dirname,"help.json"),"utf-8");return JSON.parse(O)}catch(O){return console.error("Error loading help file:",O),JSON.parse('{"no help found": "NULL"}')}},te="\x1B[32m\u25CF\x1B[0m",se=" ",ae=O=>`\x1B[32m${O}\x1B[0m`,me=async()=>{let O=process.argv.slice(2),t=O[0];if(t.length<5&&!t.startsWith("-")&&!t.startsWith("--")){console.warn("The query should be longer than 4 characters.");return}let I=O[1],e=ee(O.slice(2));if(t||(console.log("Usage: tadako <anime-title> <command> [--episode <episode-number>] [--language <language>] [other options]"),process.exit(1)),t==="--help"||t==="-h"){let{commands:i,flags:o}=await ne();Object.keys(o).forEach(a=>{let A=Object.keys(W).find(r=>`--${W[r]}`===a);A&&(o[a].short=`-${A}`)});let l=Math.max(...Object.keys(o).map(a=>a.length),...Object.values(o).map(a=>a.short?.length||0)),n=Math.max(...Object.keys(i).map(a=>a.length)),c=Object.keys(o).map(a=>{let A=o[a],r=A.short?`, ${A.short}`:"",p=A.example?` [Example: ${A.example}]`:"";return`  ${(a+r).padEnd(l+8)}${A.info}${p}`}).join(`
`),N=Object.keys(i).map(a=>`  ${a.padEnd(n+4)}${i[a]}`).join(`
`);console.log(`Usage: tadako <anime-title> [<command>] [options]

The following commands are available:
${N}

The following options are available:
${c}`),process.exit()}if(t==="--version"||t==="-v"){let{version:i}=q();console.log(`Tadako Version: ${i}`),process.exit()}if(t&&!I||I.startsWith("--")||I.startsWith("-")){let{commands:i,flags:o}=await ne();Object.keys(o).includes(t)||((t.startsWith("--")||t.startsWith("-"))&&(console.log(`"${t}" is not a valid flag. Please consult "tadako --help" for usage information.`),process.exit()),I="watch",e=ee(O.slice(1)))}let T=(i,o,l)=>{let n=process.stdout.rows,c=Math.max(0,o-Math.floor(n/2)),N=i.slice(c,c+l);console.clear();let a="";for(let A=0;A<N.length;A++){let r=c+A,p=r===o?te:se,R=r===o?ae(N[A]):N[A];a+=`${p} ${R}
`}process.stdout.write(a)},E=async i=>{let o=V.createInterface({input:process.stdin,output:process.stdout,terminal:!0}),l=0,n=process.stdout.rows-2,c=(N,a)=>{a.name==="up"?l=l>0?l-1:i.length-1:a.name==="down"?l=l<i.length-1?l+1:0:a.name==="return"&&o.close(),T(i,l,n)};return T(i,l,n),o.input?.on("keypress",c),new Promise(N=>o.on("close",()=>N(i[l])))},m=(i,o,l=10)=>{let n=process.stdout.rows,c=Math.max(1,n-2),N=Math.max(0,Math.floor(o/l)-Math.floor(c/2)),a=i.slice(N*l,(N+c)*l);console.clear();let A="";for(let r=0;r<a.length;r++){let R=N*l+r===o;A+=`${R?te:se} ${R?ae(a[r]):a[r]} `,(r+1)%l===0&&(A+=`
`)}process.stdout.write(A)},_=0,g=async(i,o=10)=>{let l=V.createInterface({input:process.stdin,output:process.stdout,terminal:!0}),n=0,c=Math.ceil(i.length/o),N=(a,A)=>{let r=Math.floor(n/o),p=n%o;A.name==="up"?n=r>0?n-o:(c-1)*o+p:A.name==="down"?n=r<c-1?n+o:p:A.name==="left"?n=p>0?n-1:r*o+(o-1):A.name==="right"?n=p<o-1&&n<i.length-1?n+1:r*o:A.name==="return"&&(_=n,l.close()),m(i.map((R,G)=>`${G+1}`),n,o)};return m(i.map((a,A)=>`${A+1}`),n,o),l.input?.on("keypress",N),new Promise(a=>l.on("close",()=>a(i[n])))},M=async()=>{let i={genre:e.genre?Number.isNaN(Number(e.genre??"null"))?P[e.genre.toUpperCase()]:e.genre:null,season:e.season||null,status:e.status?Number.isNaN(Number(e.status??"null"))?H[e.status.toUpperCase()]??x[e.status.toUpperCase()]:e.status:null,year:e.year||null,type:e.type?Number.isNaN(Number(e.type??"null"))?L[e.type.toUpperCase()]:e.type:null,studio:e.studio||null,language:e.language||"it",sort:e.sort?Number.isNaN(Number(e.sort??"null"))?B[e.sort.toUpperCase()]:e.sort:4,dub:e.dub?Number.isNaN(Number(e.dub??"null"))?["TRUE","YES","SI"].includes(e.dub.toUpperCase())?"1":"0":e.dub:null},o=(await D.search(t,i)).results,l=0;if(o.length===0){if(!e.language){let a=Object.values(b);for(;l<a.length&&(i.language=a[l],o=(await D.search(t,i)).results,!(o.length>0));)l++}o.length===0&&(console.log(`No results found for "${t}" in any language.`),process.exit(1))}let n;if(o.length===1)n=o[0];else{let a=o.map(r=>r.title),A=await E(a);n=o.find(r=>r.title===A)}n||(console.log("Selected anime not found."),process.exit(1)),console.clear(),console.log("Loading episodes..."),await n.data();let c;e.all?c=n.episodes[0]:e.episode?c=n.episodes[e.episode-1]:n.episodes.length>1?c=await g(n.episodes):c=n.episodes[0],c||(console.log(`Episode ${e.episode} not found for "${n.title}"`),process.exit(1)),console.clear(),console.log("Anime loading...");let N=await c.getDownloadURL();return N||(console.log(`No download URL found for episode ${e.episode}`),process.exit(1)),{downloadURL:N,selectedAnime:n,selectedEpisode:c}};if(I==="watch"){let i=await M();console.clear(),(()=>{try{return(0,d.execSync)(`${e["mpv-dir"]?f.join(e["mpv-dir"],"mpv"):"mpv"} --version`,{stdio:"ignore"}),!0}catch{return!1}})()||(e["mpv-dir"]?console.log(`
The mpv location provided doesn't seem to be working.`):console.log("MPV is not installed or not working properly."),process.exit(1)),console.clear();let l=async(n,c=!1,N=[])=>{if(c)return new Promise((a,A)=>{(0,d.exec)(`${e["mpv-dir"]?f.join(e["mpv-dir"],"mpv"):"mpv"} "${n}" ${e.fullscreen?"--fullscreen":""}`,r=>{r?(console.error("Error executing MPV:",r),A(r)):a()})});{let a=[n];e.fullscreen&&a.push("--fullscreen"),(0,d.spawn)(e["mpv-dir"]?f.join(e["mpv-dir"],"mpv"):"mpv",a,{detached:!0,stdio:"ignore"}).unref()}};if(e["hold-cli"]||e.all)if(e.all){let n=e.episode?e.episode-1:0;for(let c of i.selectedAnime.episodes.slice(e.episode?e.episode-1:0)){console.clear(),n+=1,console.log(`"${i.selectedAnime.title}" episode ${n} is now playing via ${e["mpv-dir"]??"mpv"}\`...`),console.log("Use CTRL + C to stop watching.");let N=await c.getDownloadURL();N&&await l(N,!0)}}else console.log(`"${i.selectedAnime.title}" episode ${e.episode??_} is now playing via ${e["mpv-dir"]??"mpv"}\`...`),await l(i.downloadURL,!0);else console.log(`"${i.selectedAnime.title}" episode ${e.episode??_} is now playing via ${e["mpv-dir"]??"mpv"}\`...`),await l(i.downloadURL)}else if(I==="download"){let i=await M();console.clear();let o=(l,n=!0)=>new h(l,e.filename??null,e["out-dir"]??null).downloadFile(e.threads??Math.ceil(F.cpus().length/2),n);if(e.all){let l=Date.now(),n=i.selectedAnime,c=n.episodes;e.episode&&(c=n.episodes.slice(e.episode-1,n.episodes.length-1));let N;for(let p of c){let R=await p.getDownloadURL();R&&(N=await o(R,!1).then(),typeof N=="string"&&console.log(N))}let a=Date.now(),A=Math.ceil((a-l)/1e3),r=U.secondsToHumanTime(A);typeof N=="string"&&(console.clear(),console.log(`Downloaded ${c.length} (${e.episode??1} -> ${n.episodes.length}) episodes of ${n.title} in ${r}.`)),console.log(`Downloaded file(s) can be found in "${e["out-dir"]??f.join(F.homedir(),"Downloads")}"`)}else{let l=Date.now(),n=i.selectedAnime,c=i.selectedEpisode,N;e.episode&&(c=n.episodes[parseInt(e.episode)-1]);let a=await c.getDownloadURL();a&&(N=await o(a,!1),typeof N=="string"&&console.log(N));let A=Date.now(),r=Math.ceil((A-l)/1e3),p=U.secondsToHumanTime(r);typeof N=="string"&&(console.clear(),console.log(`Downloaded episode ${e.episode??_} of "${n.title}" in ${p}.`)),console.log(`Downloaded file(s) can be found in "${e["out-dir"]??f.join(F.homedir(),"Downloads")}"`)}process.exit()}else if(I==="link"){let i=await M(),o=await i.selectedEpisode.getDownloadURL();if(o)if(console.clear(),e.all){let l=i.selectedAnime,n=l.episodes;e.episode&&(n=l.episodes.slice(e.episode-1,l.episodes.length-1));let c=1;for(let N of n){let a=await N.getDownloadURL();a&&(console.log(`"${l.title}" episode ${c} link:`),console.log(a),c+=1)}}else console.log(`"${i.selectedAnime.title}" episode ${e.episode??_+1} link:`),console.log(o);else console.log("No download URL found for the selected anime/episode.")}else if(I==="info"){console.clear(),console.log("Loading anime...");let i={genre:e.genre?Number.isNaN(Number(e.genre??"null"))?P[e.genre.toUpperCase()]:e.genre:null,season:e.season||null,status:e.status?Number.isNaN(Number(e.status??"null"))?H[e.status.toUpperCase()]??x[e.status.toUpperCase()]:e.status:null,year:e.year||null,type:e.type?Number.isNaN(Number(e.type??"null"))?L[e.type.toUpperCase()]:e.type:null,studio:e.studio||null,language:e.language||"it",sort:e.sort?Number.isNaN(Number(e.sort??"null"))?B[e.sort.toUpperCase()]:e.sort:4,dub:e.dub?Number.isNaN(Number(e.dub??"null"))?["TRUE","YES","SI"].includes(e.dub.toUpperCase())?"1":"0":e.dub:null},o=(await D.search(t,i)).results,l=0;if(o.length===0){if(!e.language){let r=Object.values(b);for(;l<r.length&&(i.language=r[l],o=(await D.search(t,i)).results,!(o.length>0));)l++}o.length===0&&(console.log(`No results found for "${t}" in any language.`),process.exit(1))}let n;if(o.length===1)n=o[0];else{let r=o.map(R=>R.title),p=await E(r);n=o.find(R=>R.title===p)}n||(console.log("Selected anime not found."),process.exit(1)),await n.data(),console.clear();let c=n.category!==null&&Object.keys(L).find(r=>L[r]===n.category)||"Unknown",N=n.status!==null&&Object.keys(H).find(r=>H[r]===n.status)||"Unknown",a=n.genres&&n.genres.length>0?n.genres.map(r=>Object.keys(S).find(p=>S[p]===r)||"Unknown").join(", "):"Unknown",A=n.releaseDate?n.releaseDate.toLocaleDateString():"Unknown";console.log("\x1B[1m=== ANIME INFORMATION ===\x1B[0m"),console.log(`\x1B[1mTitle:\x1B[0m ${n.title.replace(" (ITA)","")}`),n.alternativeTitle&&n.alternativeTitle!==n.title&&console.log(`\x1B[1mAlternative Title:\x1B[0m ${n.alternativeTitle.replace(" (ITA)","")}`),console.log(`\x1B[1mEpisodes:\x1B[0m ${n.episodes.length}`),n.duration&&console.log(`\x1B[1mEpisode Duration:\x1B[0m ${n.duration}`),console.log(""),n.trailer&&(console.log(`\x1B[1mTrailer:\x1B[0m ${n.trailer}`),console.log("")),console.log(`\x1B[1mStatus:\x1B[0m ${N}`),console.log(`\x1B[1mType:\x1B[0m ${c}`),console.log(`\x1B[1mRelease Date:\x1B[0m ${A}`),n.studio&&console.log(`\x1B[1mStudio:\x1B[0m ${n.studio}`),n.rating&&console.log(`\x1B[1mRating:\x1B[0m ${n.rating}/10`),n.views&&console.log(`\x1B[1mAnime World Views:\x1B[0m ${n.views.toLocaleString()}`),console.log(`\x1B[1mGenres:\x1B[0m ${a}`),console.log(""),console.log(`\x1B[1mAnime Link:\x1B[0m ${n.url}`),(n.AniListURL||n.MyAnimeListURL)&&(console.log(""),console.log("\x1B[1mExternal Links:\x1B[0m"),n.AniListURL&&console.log(` - AniList: ${n.AniListURL}`),n.MyAnimeListURL&&console.log(` - MyAnimeList: ${n.MyAnimeListURL}`)),n.shortDescription&&(console.log(""),console.log("\x1B[1mShort Description:\x1B[0m"),console.log(n.shortDescription))}else console.log("Invalid command or missing arguments"),process.exit(1)};require.main===module&&me().catch(O=>{console.error("Error:",O),process.exit(1)});
